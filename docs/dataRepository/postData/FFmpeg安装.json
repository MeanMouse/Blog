{"title": "FFmpeg \u5b89\u88c5", "date": "2023-09-19 17:35:47", "categories": "\u5de5\u5177", "tags": "FFmpeg", "keywords": "FFmpeg,rtmp,SRS,H.256", "description": "", "images": "", "file_name": "FFmpeg\u5b89\u88c5", "short": " Homebrew \u65b9\u5f0f\u5b89\u88c5 \n 1\u3001\u6267\u884c\u5b89\u88c5\u547d\u4ee4 \n     brew install ffmpeg\nbrew install ffmpeg --HEAD # \u5b89\u88c5\u6700\u65b0\n   \n\n 2\u3001\u9009\u62e9\u7b2c\u4e09\u65b9\u4ed3\u5e93: homebrew-ffmpeg \u548c varenc-homebrew-ffmpeg  \n     brew tap homebrew-ffmpeg/ffmpeg # homebrew-ffmpeg \u4ed3\u5e93\n   \n\n ", "content": "<h3 id=\"homebrew\">Homebrew \u65b9\u5f0f\u5b89\u88c5</h3>\n<p>1\u3001\u6267\u884c\u5b89\u88c5\u547d\u4ee4</p>\n<div class=\"codehilite\"><pre><span></span><code>brew install ffmpeg\nbrew install ffmpeg --HEAD # \u5b89\u88c5\u6700\u65b0\n</code></pre></div>\n\n<p>2\u3001\u9009\u62e9\u7b2c\u4e09\u65b9\u4ed3\u5e93: homebrew-ffmpeg \u548c varenc-homebrew-ffmpeg </p>\n<div class=\"codehilite\"><pre><span></span><code>brew tap homebrew-ffmpeg/ffmpeg # homebrew-ffmpeg \u4ed3\u5e93\n</code></pre></div>\n\n<!-- more -->\n<p>3\u3001\u6839\u636e\u7b2c\u4e09\u65b9\u4ed3\u5e93\u5b89\u88c5</p>\n<div class=\"codehilite\"><pre><span></span><code>brew install homebrew-ffmpeg/ffmpeg/ffmpeg\n</code></pre></div>\n\n<p>4\u3001\u5173\u8054 options</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"cp\"># \u83b7\u53d6\u652f\u6301\u7684options</span>\n<span class=\"n\">brew</span><span class=\"w\"> </span><span class=\"n\">options</span><span class=\"w\"> </span><span class=\"n\">homebrew</span><span class=\"o\">-</span><span class=\"n\">ffmpeg</span><span class=\"o\">/</span><span class=\"n\">ffmpeg</span><span class=\"o\">/</span><span class=\"n\">ffmpeg</span>\n\n<span class=\"cp\"># \u5173\u8054options</span>\n<span class=\"n\">brew</span><span class=\"w\"> </span><span class=\"n\">install</span><span class=\"w\"> </span><span class=\"n\">homebrew</span><span class=\"o\">-</span><span class=\"n\">ffmpeg</span><span class=\"o\">/</span><span class=\"n\">ffmpeg</span><span class=\"o\">/</span><span class=\"n\">ffmpeg</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">aribb24</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">chromaprint</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">decklink</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">fdk</span><span class=\"o\">-</span><span class=\"n\">aac</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">game</span><span class=\"o\">-</span><span class=\"n\">music</span><span class=\"o\">-</span><span class=\"n\">emu</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">jack</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">jpeg</span><span class=\"o\">-</span><span class=\"n\">xl</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libaribb24</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libbluray</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libbs2b</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libcaca</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libflite</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libgsm</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libmodplug</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libopenmpt</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">librist</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">librsvg</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libsoxr</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libssh</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libvidstab</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libvmaf</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libxml2</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">libzvbi</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">opencore</span><span class=\"o\">-</span><span class=\"n\">amr</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">openh264</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">openjpeg</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">openssl</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">openssl</span><span class=\"mf\">@1.1</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">rav1e</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">rtmpdump</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">rubberband</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">speex</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">srt</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">svt</span><span class=\"o\">-</span><span class=\"n\">av1</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">tesseract</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">two</span><span class=\"o\">-</span><span class=\"n\">lame</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">webp</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">xvid</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">zeromq</span><span class=\"w\"> </span><span class=\"o\">--</span><span class=\"n\">with</span><span class=\"o\">-</span><span class=\"n\">zimg</span>\n</code></pre></div>\n\n<h3 id=\"ffmpeg-rtmp-h265\">FFmpeg \u652f\u6301 RTMP H265</h3>\n<h4 id=\"libx264\">\u5b89\u88c5 libx264</h4>\n<div class=\"codehilite\"><pre><span></span><code>git clone https://code.videolan.org/videolan/x264.git\ncd x264\nmkdir build\n./configure --prefix=$(pwd)/build --disable-asm --disable-cli --disable-shared --enable-static\nmake -j10\nmake install\n</code></pre></div>\n\n<h4 id=\"libx265\">\u5b89\u88c5 libx265</h4>\n<div class=\"codehilite\"><pre><span></span><code>git clone https://bitbucket.org/multicoreware/x265_git.git\ncd x265_git/build/linux\nmkdir build\ncmake -DCMAKE_INSTALL_PREFIX=$(pwd)/build -DENABLE_SHARED=OFF ../../source\nmake -j10\nmake install\n</code></pre></div>\n\n<h4 id=\"libx264libx265\">\u8bbe\u7f6e libx264\u3001libx265 \u73af\u5883\u53d8\u91cf</h4>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"k\">export</span><span class=\"w\"> </span><span class=\"n\">PKG_CONFIG_PATH</span><span class=\"o\">=~/</span><span class=\"n\">x264</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">pkgconfig</span><span class=\"p\">:</span><span class=\"o\">~/</span><span class=\"n\">x265_git</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">linux</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">pkgconfig</span>\n</code></pre></div>\n\n<h4 id=\"ffmpeg-rtmpflv-h265\">ffmpeg \u4e2d rtmp/flv \u6a21\u5757\u652f\u6301 h.265</h4>\n<div class=\"codehilite\"><pre><span></span><code>git clone -b 5.1 https://github.com/runner365/ffmpeg_rtmp_h265.git\ncd ffmpeg_rtmp_h265\ncp flv.h ~/FFmpeg/libavformat/\ncp flv*.c ~/FFmpeg/libavformat/\n</code></pre></div>\n\n<h4 id=\"ffmpeg\">ffmpeg \u91cd\u65b0\u7f16\u8bd1\u5b89\u88c5</h4>\n<div class=\"codehilite\"><pre><span></span><code>git clone https://github.com/FFmpeg/FFmpeg.git\ncd FFmpeg\ngit checkout n6.0\nmkdir build\n./configure \\\n  --prefix=$(pwd)/build \\\n  --enable-gpl --enable-nonfree --enable-pthreads --extra-libs=-lpthread \\\n  --disable-asm --disable-x86asm --disable-inline-asm \\\n  --enable-decoder=aac --enable-decoder=aac_fixed --enable-decoder=aac_latm --enable-encoder=aac \\\n  --enable-libx264 --enable-libx265 \\\n  --pkg-config-flags=&#39;--static&#39;\nmake -j10\nmake install\n</code></pre></div>\n\n<h3 id=\"rtmpflv-h265\">rtmp/flv h.265 \u670d\u52a1\u5668\u652f\u6301</h3>\n<p>nginx-rtmp \u53ea\u652f\u6301 h.264, SRS \u5df2\u652f\u6301 rtmp/flv h.265, \u56e0\u6b64\u5efa\u8bae\u4f7f\u7528 SRS \u670d\u52a1.</p>\n<div class=\"codehilite\"><pre><span></span><code>git clone https://github.com/ossrs/srs.git\ncd trunk\n./configure --osx --h265=on\nmake\n</code></pre></div>\n\n<p>SRS \u76f8\u5173\u64cd\u4f5c\u6307\u4ee4</p>\n<div class=\"codehilite\"><pre><span></span><code># \u542f\u52a8\n./objs/srs -c conf/rtmp.conf\n\n# \u67e5\u770b\u65e5\u5fd7\ntail -n 30 -f ./objs/srs.log\n\n# \u67e5\u770b\u670d\u52a1\u5668\u72b6\u6001\n./etc/init.d/srs status\n</code></pre></div>\n\n<p>\u5177\u4f53\u8be6\u7ec6\u89c1\u6587\u6863<a href=\"https://ossrs.net/lts/zh-cn/docs/v5/doc/getting-started-build\">SRS</a></p>"}