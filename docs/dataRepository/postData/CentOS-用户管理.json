{"title": "CentOS \u7528\u6237\u7ba1\u7406", "date": "2018-11-28 15:16:47", "categories": "Linux", "tags": "CentOS", "keywords": "CentOS,\u7528\u6237\u7ba1\u7406", "description": "", "file_name": "CentOS-\u7528\u6237\u7ba1\u7406", "short": " \u6574\u7406\u6765\u6e90\uff1a\u300a\u9e1f\u54e5\u7684Linux\u79c1\u623f\u83dc\u7b2c\u56db\u7248\u300b\u7684\u7b2c\u5341\u4e09\u7ae0 \u201c\u8d26\u53f7\u7ba1\u7406\u4e0e ACL \u6743\u9650\u8bbe\u5b9a\u201d \n \u7528\u6237\u8d26\u53f7 \n Linux \u5982\u4f55\u8fa8\u522b\u4f7f\u7528\u8005\u8eab\u4efd \n \u6211\u4eec\u767b\u5f55 Linux\u65f6\uff0c\u8f93\u5165\u7684\u662f\u6211\u4eec\u7684\u8d26\u53f7\uff0c\u5176\u5b9e \nLinux \u4f7f\u7528\u7684\u5e76\u4e0d\u662f\u4f60\u7684\u8d26\u53f7\uff0c\u800c\u662f\u8d26\u53f7\u6240\u5bf9\u5e94\u7684UID\uff08UserID\uff09,\u8d26\u53f7\u53ea\u662f\u4e3a\u4e86\u8ba9\u4f7f\u7528\u8005\u66f4\u597d\u8bb0\u5fc6\u3002\u6709\u5173UID\u4e0e\u8d26\u53f7\u7684\u5bf9\u5e94\u4fe1\u606f\u5b58\u50a8\u5728 /etc/passwd\uff0c\u9664\u4e86UID\u5916\u8fd8\u6709\u4e00\u4e2a\u7fa4\u7ec4ID\uff1aGID\uff08GroupID\uff09\uff0cGID\u4e0e\u8d26\u53f7\u5bf9\u5e94\u7684\u4fe1\u606f\u5b58\u50a8\u5728 /etc/group\u4e2d\u3002\u5f53\u7528\u6237\u767b\u5f55\u65f6\uff0cLinux\u65f6\u4fbf\u4f1a\u6839\u636e\u8d26\u53f7\u53bb /etc/passwd\u548c/etc/group\u7684\u4fe1\u606f\u4e2d\u627e\u5230 UID\u548cGID\u5bf9\u5e94\u7684\u8d26\u53f7\u4e0e\u7ec4\u540d\u663e\u793a\u51fa\u6765\u3002 \n ", "content": "<p>\u6574\u7406\u6765\u6e90\uff1a\u300a\u9e1f\u54e5\u7684Linux\u79c1\u623f\u83dc\u7b2c\u56db\u7248\u300b\u7684\u7b2c\u5341\u4e09\u7ae0 \u201c\u8d26\u53f7\u7ba1\u7406\u4e0e ACL \u6743\u9650\u8bbe\u5b9a\u201d</p>\n<h3 id=\"_1\">\u7528\u6237\u8d26\u53f7</h3>\n<h4 id=\"linux\">Linux \u5982\u4f55\u8fa8\u522b\u4f7f\u7528\u8005\u8eab\u4efd</h4>\n<p>\u6211\u4eec\u767b\u5f55 Linux\u65f6\uff0c\u8f93\u5165\u7684\u662f\u6211\u4eec\u7684\u8d26\u53f7\uff0c\u5176\u5b9e<br />\nLinux \u4f7f\u7528\u7684\u5e76\u4e0d\u662f\u4f60\u7684\u8d26\u53f7\uff0c\u800c\u662f\u8d26\u53f7\u6240\u5bf9\u5e94\u7684UID\uff08UserID\uff09,\u8d26\u53f7\u53ea\u662f\u4e3a\u4e86\u8ba9\u4f7f\u7528\u8005\u66f4\u597d\u8bb0\u5fc6\u3002\u6709\u5173UID\u4e0e\u8d26\u53f7\u7684\u5bf9\u5e94\u4fe1\u606f\u5b58\u50a8\u5728 /etc/passwd\uff0c\u9664\u4e86UID\u5916\u8fd8\u6709\u4e00\u4e2a\u7fa4\u7ec4ID\uff1aGID\uff08GroupID\uff09\uff0cGID\u4e0e\u8d26\u53f7\u5bf9\u5e94\u7684\u4fe1\u606f\u5b58\u50a8\u5728 /etc/group\u4e2d\u3002\u5f53\u7528\u6237\u767b\u5f55\u65f6\uff0cLinux\u65f6\u4fbf\u4f1a\u6839\u636e\u8d26\u53f7\u53bb /etc/passwd\u548c/etc/group\u7684\u4fe1\u606f\u4e2d\u627e\u5230 UID\u548cGID\u5bf9\u5e94\u7684\u8d26\u53f7\u4e0e\u7ec4\u540d\u663e\u793a\u51fa\u6765\u3002</p>\n<!-- more -->\n<h4 id=\"linux_1\">Linux \u767b\u5f55</h4>\n<p>\u767b\u5f55Linux\u65f6\uff0cLiunx \u5bf9\u4e8e\u7528\u6237\u7684\u8d26\u53f7\u3001\u5bc6\u7801\u8f93\u5165\u8fdb\u884c\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4</p>\n<ol>\n<li>\u5148\u67e5\u8be2 /etc/passwd \u4e2d\u662f\u5426\u6709\u4f60\u8f93\u5165\u7684\u8d26\u53f7\uff0c\u5982\u679c\u6709\u7684\u8bdd\u5219\u5c06\u8d26\u53f7\u5bf9\u5e94\u7684 UID \u8bfb\u51fa\u6765\u5e76\u53bb /etc/group \u4e2d\u5c06GID\u4e5f\u8bfb\u51fa\u6765\uff0c\u53e6\u5916\u5bf9\u4e8e\u8be5\u8d26\u53f7\u7684\u5bb6\u76ee\u5f55\u4e0e shell \u8bbe\u5b9a\u4e5f\u4e00\u5e76\u8bfb\u51fa\u3002</li>\n<li>Linux \u4f1a\u8fdb\u5165 /etc/shadow \u91cc\u627e\u51fa\u5bf9\u5e94\u7684\u5e94\u7684\u8d26\u53f7\u548c UID\u53bb\u6838\u5bf9\u7528\u6237\u8f93\u5165\u7684\u767b\u5f55\u5bc6\u7801\u3002</li>\n<li>\u6838\u5bf9\u6210\u529f\u7684\u8bdd\uff0c\u5c31\u8fdb\u5165shell\u3002</li>\n</ol>\n<h4 id=\"_2\">\u8d26\u53f7\u5bc6\u7801\u4fe1\u606f\u76f8\u5173\u6587\u4ef6</h4>\n<h5 id=\"etcpasswd\">/etc/passwd</h5>\n<p>\u5b58\u50a8\u7740\u8d26\u53f7\u4fe1\u606f\uff0c\u6bcf\u4e00\u884c\u4ee3\u8868\u4e00\u4e2a\u8d26\u53f7\uff0c\u91cc\u9762\u9664\u4e86\u7528\u6237\u8d26\u53f7\u8fd8\u6709\u8bb8\u591a\u7cfb\u7edf\u8d26\u53f7\uff08\u7cfb\u7edf\u8fd0\u4f5c\u6240\u9700\uff09\uff0c\u6bcf\u4e00\u884c\u7684\u884c\u7684\u8d26\u53f7\u4fe1\u606f\u683c\u5f0f\u5982\u4e0b</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">// \u4ee5 \u201c:\u201d \u7b26\u53f7\u5206\u5272\nroot : x : 0 : 0 : root : /root : /bin/bash\n\n\n1. \u201croot\u201d\uff1a \u8fd9\u662froot\u7684\u8d26\u53f7\u540d\u79f0\uff08\u5373\u8d26\u53f7\uff09\n2. \u8fd9\u4e2a\u5b57\u6bb5\u5728\u65e9\u671f Unix \u662f\u653e\u7528\u6237\u7684\u5bc6\u7801\uff0c\u7531\u4e8e\u8fd9\u4e2a\u6587\u4ef6\u6240\u6709\u7684\u7a0b\u5e8f\u90fd\u80fd\u8bfb\u53d6\uff0c\u6240\u4ee5\u5c06\u5bc6\u7801 \u6539\u653e\u5230 /etc/shadow \u4e2d\uff0c\u8fd9\u91cc\u53ea\u7559\u4e2a \u201cx\u201d\u3002\n3. \u8fd9\u662f\u7528\u6237\u7684 UID\uff0c\u5f53 UID \u4e3a0\u65f6\u4ee3\u8868\u8fd9\u4e2a\u8d26\u53f7\u662f\u7cfb\u7edf\u7ba1\u7406\u5458\uff0c\u60f3\u8ba9\u5176\u4ed6\u8d26\u53f7\u4e5f\u62e5\u4e8e root \u6743\u9650\u53ef\u5c06\u5176 UID \u8bbe\u4e3a0\u3002\u7cfb\u7edf\u8d26\u53f7\u7684UID\u57281000\u4ee5\u4e0b\uff0c\u4e00\u822c\u8d26\u53f7\u7684UID\u57281000\u4ee5\u4e0a\u3002\n4. GID\uff08\u7fa4\u7ec4id\uff09\n5. \u7528\u6237\u4fe1\u606f\u8bf4\u660e\u680f\uff0c\u7528\u6765\u63cf\u8ff0\u8d26\u53f7\u7684\u610f\u4e49\uff0c\u57fa\u672c\u6ca1\u6709\u91cd\u8981\u7684\u7528\u9014\u3002\n6. \u5bb6\u76ee\u5f55\uff0c\u5f53\u7528\u6237\u767b\u5f55\u540e\u5c31\u4f1a\u8fdb\u5165\u7528\u6237\u8d26\u53f7\u6240\u5bf9\u5e94\u7684\u5bb6\u76ee\u5f55\u5730\u5740\u3002\n7. \u7528\u4e8e\u4e0e Linux \u7cfb\u7edf\u6c9f\u901a\u7684shell\u3002\n</code></pre>\n\n<h5 id=\"etcshadow\">/etc/shadow</h5>\n<p>\u50a8\u5b58\u7740\u8d26\u53f7\u5bf9\u5e94\u7684\u5bc6\u7801\u7b49\u4fe1\u606f\uff0c\u8be5\u6587\u4ef6\u9884\u8bbe\u6743\u9650\u662f -rw------- \u6216\u8005 ----------\uff0c\u4e3a\u4e86\u8d26\u53f7\u5b89\u5168\u8bf7\u6ce8\u610f\u8be5\u6587\u4ef6\u7684\u6743\u9650\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">root : $6$pUfomqmbz6D2LPAv$Q : : 0 : 99999 : 7 : : :\n\n\n1. \u8d26\u53f7\u540d\u79f0\n2. \u8d26\u53f7\u5bf9\u5e94\u7684\u5bc6\u7801\uff0c\u52a0\u5bc6\u673a\u5236\u7684\u67e5\u8be2\u547d\u4ee4\uff1aauthconfig --test | grep hashing\n3. \u6700\u8fd1\u66f4\u6539\u5bc6\u7801\u7684\u65e5\u671f\uff0c\u4e0a\u9762\u4e3a\u7a7a\u662f\u56e0\u4e3a\u6211\u6ca1\u6539\u8fc7\u5bc6\u7801\uff0c\u5982\u679c\u6709\u6539\u52a8\u5c31\u4f1a\u6709\u4e2a\u6570\u5b57\u6bd4\u5982\uff1a16559\uff0c\u8fd9\u6570\u5b57\u7684\u5f97\u6765\u662f\u4ee51970\u5e741\u67081\u65e5\uff08Liux \u8ba1\u7b97\u65e5\u671f\u65f6\u95f4\u7684\u57fa\u51c6\uff09\u4f5c\u4e3a 1 \u7d2f\u52a0\u7684\u5929\u6570\uff0c\u6240\u4ee516559 \u5c31\u662f 2015\u5e745\u67084\u53f7\u3002\n4. \u5bc6\u7801\u4e0d\u53ef\u66f4\u6539\u7684\u5929\u6570\uff0c0 \u4e3a\u53ef\u4ee5\u7acb\u5373\u66f4\u6539\uff0c30\u662f30\u5929\u540e\u624d\u80fd\u66f4\u6539\u5bc6\u7801\u3002\n5. \u5bc6\u7801\u9700\u8981\u91cd\u65b0\u66f4\u6539\u7684\u5929\u6570\uff0c\u7528\u6237\u5fc5\u987b\u5728\u8fd9\u4e2a\u5929\u6570\u5185\u91cd\u7f6e\u5bc6\u7801\uff0c\u5426\u5219\u8d26\u6237\u5bc6\u7801\u4f1a\u8fc7\u671f\u3002\u6bd4\u5982 30 \u7684\u8bdd\u5c31\u662f30\u5929\u4e4b\u5185\u5fc5\u987b\u91cd\u7f6e\uff0c\u8fd9\u91cc\u662f99999\uff08\u9ed8\u8ba4\uff09\uff0c\u5443\uff0c\u8fd9\u4e2a\u5c31\u6bd4\u8f83\u4e45\u4e86\u3002\n6. \u5bc6\u7801\u9700\u8981\u53d8\u66f4\u7684\u671f\u9650\u5230\u671f\u524d\u7684\u8b66\u793a\u5929\u6570\uff0c\u8fd9\u91cc\u662f7\uff0c\u610f\u601d\u662f\u5728\u5bc6\u7801\u9700\u8981\u53d8\u66f4\u7684\u671f\u9650\u7684\u524d7\u5929\u4e4b\u5185\uff0c\u7cfb\u7edf\u4f1a\u8b66\u793a\u7528\u6237\u53bb\u9700\u8981\u53bb\u53d8\u66f4\u5bc6\u7801\u3002\n7. \u5bc6\u7801\u8fc7\u671f\u540e\u7684\u7ee7\u7eed\u751f\u6548\u7684\u5bbd\u9650\u5929\u6570\uff0c\u8fd9\u91cc\u6ca1\u6709\u7684\u8bdd\u5c31\u662f\u5bc6\u7801\u8fc7\u671f\u540e\u5c31\u7acb\u5373\u5931\u6548\uff0c\u7528\u6237\u518d\u6b21\u767b\u5f55\u65f6\u9700\u91cd\u65b0\u8bbe\u7f6e\u5bc6\u7801\u624d\u80fd\u4f7f\u7528\uff0c\u5982\u679c\u4e3a7\u7684\u8bdd\uff0c\u5373\u4f7f\u5bc6\u7801\u8fc7\u671f\u4e86\uff0c\u5728\u8fc7\u671f7\u5929\u5185\u8fd8\u80fd\u4f7f\u7528\u5bc6\u7801\uff0c7\u5929\u540e\u5bc6\u7801\u5931\u6548\u3002\n8. \u8d26\u53f7\u7684\u5931\u6548\u65e5\u671f\uff0c\u8fd9\u4e2a\u65e5\u671f\u548c\u7b2c\u4e09\u4e2a\u5b57\u6bb5\u4e00\u6837\u7684\u8ba1\u7b97\u65b9\u5f0f\uff0c\u5230\u4e86\u671f\u9650\u540e\uff0c\u8d26\u53f7\u5931\u6548\uff08\u5373\u4f7f\u4f60\u5bc6\u7801\u6ca1\u8fc7\u671f\uff09\u3002\n9. \u9884\u7559\u7684\u529f\u80fd\u4f4d\u7f6e\n</code></pre>\n\n<h5 id=\"_3\">\u7528\u6237\u4fe1\u606f\u67e5\u8be2\u547d\u4ee4</h5>\n<ul>\n<li>id\uff1a\u67e5\u8be2\u7528\u6237\u7684\u76f8\u5173 UID/GID \u7b49\u7b49\u7684\u4fe1\u606f</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\"># id \u7528\u6237\u540d    // \u4e0d\u52a0\u7528\u6237\u540d\uff0c\u9ed8\u8ba4\u67e5\u8be2\u5f53\u524d\u7528\u6237\n</code></pre>\n\n<ul>\n<li>finger\uff1a\u67e5\u9605\u5f88\u591a\u7528\u6237\u76f8\u5173\u7684\u4fe1\u606f</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\"># finger \u7528\u6237\u540d    // \u4e0d\u52a0\u7528\u6237\u540d\uff0c\u9ed8\u8ba4\u67e5\u8be2\u5f53\u524d\u7528\u6237\n\nLogin: \u4e3a\u4f7f\u7528\u8005\u8d26\u53f7\uff0c\u4ea6\u5373 /etc/passwd \u5185\u7684\u7b2c\u4e00\u5b57\u6bb5;\nName: \u4e3a\u5168\u540d\uff0c\u4ea6\u5373 /etc/passwd \u5185\u7684\u7b2c\u4e94\u5b57\u6bb5(\u6216\u79f0\u4e3a\u6279\u6ce8);\nDirectory: \u5c31\u662f\u5bb6\u76ee\u5f55\u4e86;\nShell: \u5c31\u662f\u4f7f\u7528\u7684 Shell \u6587\u4ef6\u6240\u5728;\nNever logged in.: figner \u8fd8\u4f1a\u8c03\u67e5\u7528\u6237\u767b\u5165\u4e3b\u673a\u7684\u60c5\u51b5\u5594!\nNo mail.: \u8c03\u67e5 /var/spool/mail \u5f53\u4e2d\u7684\u4fe1\u7bb1\u8d44\u6599;\nNo Plan.: \u8c03\u67e5 ~vbird1/.plan \u6587\u4ef6\uff0c\u5e76\u5c06\u8be5\u6587\u4ef6\u53d6\u51fa\u6765\u8bf4\u660e!\n</code></pre>\n\n<p>\u5efa\u7acb\u81ea\u5df1\u7684\u8ba1\u5212\u5185\u5bb9\uff1a</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># echo &quot;I will study Linux during this year.&quot; &gt; ~/.plan\n\n\u4e0a\u9762\u7684 No Plan.: \u53d8\u6210\u4e86\nPlan:\nI will study Linux during this year.\n</code></pre>\n\n<ul>\n<li>chfn\uff1a\u5927\u81f4\u6709\u70b9\u50cf change finger \u7684\u610f\u601d</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\"># chfn \u7528\u6237\u540d    // \u4e0d\u52a0\u7528\u6237\u540d\uff0c\u9ed8\u8ba4\u67e5\u8be2\u5f53\u524d\u7528\u6237\n</code></pre>\n\n<p>\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-f : \u540e\u9762\u63a5\u5b8c\u6574\u7684\u5927\u540d;\n-o : \u60a8\u529e\u516c\u5ba4\u7684\u623f\u95f4\u53f7\u7801; \n-p : \u529e\u516c\u5ba4\u7684\u7535\u8bdd\u53f7\u7801; \n-h : \u5bb6\u91cc\u7684\u7535\u8bdd\u53f7\u7801!\n</code></pre>\n\n<ul>\n<li>chsh\uff1achange shell \u7684\u7b80\u5199</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">// \u7528\u5f53\u524d\u7684\u8eab\u4efd\u5217\u51fa\u7cfb\u7edf\u4e0a\u6240\u6709\u5408\u6cd5\u7684 shell\n# chsh -l\n\n// \u4fee\u6539Shell\n# chsh -s shell\n</code></pre>\n\n<h4 id=\"_4\">\u7528\u6237\u521b\u5efa</h4>\n<pre class=\"codehilite\"><code class=\"language-shell\"># useradd \u7528\u6237\u540d   // \u91c7\u7528\u9ed8\u8ba4\u914d\u7f6e\u521b\u5efa\u7528\u6237\n# useradd -D  // \u67e5\u770b useradd \u7684\u9ed8\u8ba4\u914d\u7f6e\n\n\u9ed8\u8ba4\u914d\u7f6e\uff1a\nGROUP=100  // \u9884\u8bbe\u7684\u7fa4\u7ec4\uff0c\u5728centos \u9ed8\u8ba4\u7684\u521d\u59cb\u7fa4\u7ec4\u662f\u4e0e\u8d26\u53f7\u540d\u76f8\u540c\u7684\u7fa4\u7ec4\nHOME=/home  // \u5bb6\u76ee\u5f55\nINACTIVE=-1  // \u5bc6\u7801\u5931\u6548\u65e5\u671f\uff0c/etc/shadow \u5185\u7684\u7b2c7\u680f\nEXPIRE=  // \u8d26\u6237\u5931\u6548\u65e5\u671f\uff0c/etc/shadow \u5185\u7684\u7b2c8\u680f\nSHELL=/bin/bash  // \u9884\u8bbe\u7684shell\nSKEL=/etc/skel  // \u7528\u6237\u5bb6\u76ee\u5f55\u7684\u5185\u5bb9\u6570\u636e\u53c2\u8003\u76ee\u5f55\nCREATE_MAIL_SPOOL=yes  // \u662f\u5426\u4e3b\u52a8\u5e2e\u7528\u6237\u5efa\u7acb\u90ae\u4ef6\u4fe1\u7bb1\n\nUID\u3001GID\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6 /etc/login.defs:\nMAIL_DIR        /var/spool/mail  // \u9ed8\u8ba4\u90ae\u7bb1\u76ee\u5f55\nPASS_MAX_DAYS   99999  // \u9700\u53d8\u66f4\u5bc6\u7801\u7684\u5929\u6570\uff0c/etc/shadow \u7684\u7b2c5\u680f\nPASS_MIN_DAYS   0  // \u53ef\u518d\u6b21\u91cd\u8bbe\u5bc6\u7801\u7684\u5929\u6570\uff0c/etc/shadow \u7684\u7b2c4\u680f\nPASS_MIN_LEN    5  // \u5bc6\u7801\u7684\u6700\u77ed\u5b57\u7b26\u957f\u5ea6\uff0c\u88ab pam \u6a21\u5757\u53d6\u4ee3\uff0c\u5931\u53bb\u6548\u7528\nPASS_WARN_AGE   7  // \u8fc7\u671f\u524d\u4f1a\u8b66\u544a\u7684\u5929\u6570\uff0c/etc/shadow \u7684\u7b2c6\u680f\nUID_MIN                  1000  // \u4f7f\u7528\u8005\u6700\u5c0f\u7684 UID\uff0c\u610f\u5373\u5c0f\u4e8e 1000 \u7684 UID \u4e3a\u7cfb\u7edf\u4fdd\u7559\nUID_MAX                 60000  // \u4f7f\u7528\u8005\u80fd\u591f\u7528\u7684\u6700\u5927 UID\nSYS_UID_MIN               201  // \u4fdd\u7559\u7ed9\u7528\u6237\u81ea\u884c\u8bbe\u5b9a\u7684\u7cfb\u7edf\u8d26\u53f7\u6700\u5c0f\u503c UID\nSYS_UID_MAX               999  // \u4fdd\u7559\u7ed9\u7528\u6237\u81ea\u884c\u8bbe\u5b9a\u7684\u7cfb\u7edf\u8d26\u53f7\u6700\u5927\u503c UID\nGID_MIN                  1000  // \u4f7f\u7528\u8005\u81ea\u5b9a\u4e49\u7ec4\u7684\u6700\u5c0f GID\uff0c\u5c0f\u4e8e 1000 \u4e3a\u7cfb\u7edf\u4fdd\u7559\nGID_MAX                 60000  // \u4f7f\u7528\u8005\u81ea\u5b9a\u4e49\u7ec4\u7684\u6700\u5927 GID\nSYS_GID_MIN               201  // \u4fdd\u7559\u7ed9\u7528\u6237\u81ea\u884c\u8bbe\u5b9a\u7684\u7cfb\u7edf\u8d26\u53f7\u6700\u5c0f\u503c GID\nSYS_GID_MAX               999  // \u4fdd\u7559\u7ed9\u7528\u6237\u81ea\u884c\u8bbe\u5b9a\u7684\u7cfb\u7edf\u8d26\u53f7\u6700\u5927\u503c GID\nCREATE_HOME     yes  // \u5728\u4e0d\u52a0 -M \u53ca -m \u65f6\uff0c\u662f\u5426\u4e3b\u52a8\u5efa\u7acb\u7528\u6237\u5bb6\u76ee\u5f55\nUMASK           077  // \u7528\u6237\u5bb6\u76ee\u5f55\u5efa\u7acb\u7684 umask \uff0c\u56e0\u6b64\u6743\u9650\u4f1a\u662f 700\nUSERGROUPS_ENAB yes  // \u4f7f\u7528 userdel \u5220\u9664\u65f6\uff0c\u662f\u5426\u4f1a\u5220\u9664\u521d\u59cb\u7fa4\u7ec4\nENCRYPT_METHOD SHA512  // \u5bc6\u7801\u52a0\u5bc6\u7684\u673a\u5236\u4f7f\u7528\u7684\u662f sha512 \u8fd9\u4e00\u4e2a\u673a\u5236!\n\n// \u4e5f\u53ef\u4ee5\u6307\u5b9a\u67d0\u9879\u914d\u7f6e\u521b\u5efa\u7528\u6237\uff0c\u6307\u4ee4\u5f62\u5f0f\u5982\u4e0b\n# useradd -u UID -g GID -G \u6b21\u8981\u7fa4\u7ec4 \u7528\u6237\u540d\n\n\u9009\u9879\u4e0e\u53c2\u6570\uff1a\n-u : \u503c\u662fUID\uff0c\u662f\u4e00\u7ec4\u6570\u5b57\uff0c\u7528\u4e8e\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684UID\n-g : \u503c\u662f\u7fa4\u7ec4\u540d\uff0c\u662f\u4e00\u7ec4\u6570\u5b57\uff0c\u7528\u4e8e\u6307\u5b9a\u521d\u59cb\u7fa4\u7ec4\n-G : \u503c\u662f\u65b0\u5efa\u7528\u6237\u8981\u52a0\u5165\u7684\u7fa4\u7ec4\n-M : \u65e0\u503c\uff0c\u4e0d\u5efa\u7acb\u5bb6\u76ee\u5f55\uff08\u7cfb\u7edf\u8d26\u53f7\u9ed8\u8ba4\uff09\n-m : \u65e0\u503c\uff0c\u5efa\u7acb\u5bb6\u76ee\u5f55\uff08\u4e00\u822c\u8d26\u53f7\u9ed8\u8ba4\uff09\n-c : \u503c\u4e3a\u5bf9\u8d26\u53f7\u7684\u8bf4\u660e\u5185\u5bb9\uff0c\u663e\u793a\u5728 /etc/passwd \u7684\u7b2c\u4e94\u4e2a\u5b57\u6bb5\n-d : \u503c\u4e3a\u76ee\u6807\u76ee\u5f55\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u7528\u4e8e\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684\u5bb6\u76ee\u5f55\n-r : \u5efa\u7acb\u4e00\u4e2a\u7cfb\u7edf\u7684\u8d26\u53f7\n-s : \u503c\u6307\u5b9a\u4e00\u4e2ashell\uff0c\u82e5\u6ca1\u6709\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3a\uff1a/bin/bash\n-e : \u503c\u4e3a\u65e5\u671f\uff0c\u683c\u5f0f\u201c YYYY-MM-DD \u201d\uff0c\u8d26\u53f7\u7684\u5931\u6548\u65e5\u671f\n-f : \u503c\u4e3a\u5929\u6570\uff0c\u5bc6\u7801\u5931\u6548\u7684\u5929\u6570\uff0c0\u4e3a\u7acb\u5373\u5931\u6548\uff0c-1\u6c38\u4e0d\u5931\u6548\u3002\n</code></pre>\n\n<h4 id=\"_5\">\u914d\u7f6e\u7528\u6237\u5bc6\u7801</h4>\n<p>\u6240\u6709\u4eba\u5747\u53ef\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u6539\u81ea\u5df1\u7684\u5bc6\u7801\uff0c\u4e0d\u52a0\u7528\u6237\u540d\uff0c\u9ed8\u8ba4\u4fee\u6539\u5f53\u524d\u767b\u5f55\u7528\u6237\u5bc6\u7801\uff0c\u4e00\u822c\u8d26\u53f7\u9700\u8981\u8f93\u5165\u65e7\u5bc6\u7801\u6765\u66f4\u6539\u5bc6\u7801\uff0croot \u7528\u6237\u4e0d\u9700\u8981\u3002</p>\n<h5 id=\"passwd\">passwd</h5>\n<pre class=\"codehilite\"><code class=\"language-shell\"># passwd \u7528\u6237\u540d  \n</code></pre>\n\n<p>passwd \u547d\u4ee4\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">--stdin : \u53ef\u4ee5\u900f\u8fc7\u6765\u81ea\u524d\u4e00\u4e2a\u7ba1\u7ebf\u7684\u6570\u636e\uff0c\u4f5c\u4e3a\u5bc6\u7801\u8f93\u5165\uff0c\u5bf9 shell script \u6709\u5e2e\u52a9! -l : \u662f Lock \u7684\u610f\u601d\uff0c\u4f1a\u5c06 /etc/shadow \u7b2c\u4e8c\u680f\u6700\u524d\u9762\u52a0\u4e0a ! \u4f7f\u5bc6\u7801\u5931\u6548\u3002\n-u : \u4e0e -l \u76f8\u5bf9\uff0c\u662f Unlock \u7684\u610f\u601d!\n-S : \u5217\u51fa\u5bc6\u7801\u76f8\u5173\u53c2\u6570\uff0c\u4ea6\u5373 shadow \u6587\u4ef6\u5185\u7684\u5927\u90e8\u5206\u4fe1\u606f\u3002 \n-n : \u540e\u9762\u63a5\u5929\u6570\uff0c/etc/shadow \u7684\u7b2c 4 \u5b57\u6bb5\uff0c\u591a\u4e45\u4e0d\u53ef\u4fee\u6539\u5bc6\u7801\u5929\u6570 \n-x : \u540e\u9762\u63a5\u5929\u6570\uff0c/etc/shadow \u7684\u7b2c 5 \u5b57\u6bb5\uff0c\u591a\u4e45\u5185\u5fc5\u987b\u8981\u66f4\u52a8\u5bc6\u7801 \n-w : \u540e\u9762\u63a5\u5929\u6570\uff0c/etc/shadow \u7684\u7b2c 6 \u5b57\u6bb5\uff0c\u5bc6\u7801\u8fc7\u671f\u524d\u7684\u8b66\u544a\u5929\u6570 \n-i : \u540e\u9762\u63a5\u65e5\u671f\uff0c/etc/shadow \u7684\u7b2c 7 \u5b57\u6bb5\uff0c\u5bc6\u7801\u5931\u6548\u65e5\u671f\n</code></pre>\n\n<p>--stdin\u7684\u4f7f\u7528\uff1a\u53d8\u66f4\u7528\u6237\u5bc6\u7801\uff0c\u6b64\u65b9\u6cd5\u7f3a\u70b9\u662f\u8fd9\u4e2a\u5bc6\u7801\u4f1a\u4fdd\u7559\u5728\u6307\u4ee4\u4e2d\uff0c\u53ef\u4ee5\u5728 /root/.bash_history \u627e\u5230\u8fd9\u4e2a\u5bc6\u7801\uff0c\u6240\u4ee5\u8fd9\u4e2a\u52a8\u4f5c\u901a\u5e38\u4ec5\u7528\u5728 shell script \u7684\u5927\u91cf\u5efa\u7acb\u4f7f\u7528\u8005\u8d26\u53f7\u5f53\u4e2d! \u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u9009\u9879\u5e76\u4e0d\u5b58\u5728\u6240\u6709 distributions \u7248 \u672c\u4e2d\uff0c \u8bf7\u4f7f\u7528 man passwd \u786e\u8ba4\u4f60\u7684 distribution \u662f\u5426\u6709\u652f\u6301\u6b64\u9009\u9879\uff01</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">echo &quot;AbcXXX21&quot; | passwd --stdin \u7528\u6237\u540d\n</code></pre>\n\n<p>\u5bc6\u7801\u8bbe\u7f6e\u8981\u6c42\uff1a</p>\n<ol>\n<li>\u5bc6\u7801\u4e0d\u80fd\u4e0e\u8d26\u53f7\u76f8\u540c\uff0c\u5bc6\u7801\u5c3d\u91cf\u4e0d\u8981\u9009\u7528\u5b57\u5178\u91cc\u9762\u4f1a\u51fa\u73b0\u7684\u5b57\u8bcd</li>\n<li>\u5bc6\u7801\u9700\u8981\u8d85\u8fc7 8 \u4e2a\u5b57\u7b26</li>\n<li>\u5bc6\u7801\u4e0d\u8981\u4f7f\u7528\u4e2a\u4eba\u4fe1\u606f\uff0c\u5982\u8eab\u4efd\u8bc1\u3001\u624b\u673a\u53f7\u7801\u3001\u5176\u4ed6\u7535\u8bdd\u53f7\u7801\u7b49</li>\n<li>\u5bc6\u7801\u4e0d\u8981\u4f7f\u7528\u7b80\u5355\u7684\u5173\u7cfb\u5f0f\uff0c\u5982 1+1=2\uff0c Iamvbird \u7b49</li>\n<li>\u5bc6\u7801\u5c3d\u91cf\u4f7f\u7528\u5927\u5c0f\u5199\u5b57\u7b26\u3001\u6570\u5b57\u3001\u7279\u6b8a\u5b57\u7b26($,_,-\u7b49)\u7684\u7ec4\u5408</li>\n</ol>\n<h5 id=\"chage\">chage</h5>\n<p>\u4e0e passwd \u4e00\u6837\u7684\u529f\u80fd\u547d\u4ee4\uff0c\u80fd\u5c55\u793a\u66f4\u4e3a\u8be6\u7ec6\u7684\u5bc6\u7801\u53c2\u6570\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># chage \u8d26\u53f7\n</code></pre>\n\n<p>chage \u547d\u4ee4\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-l : \u5217\u51fa\u8be5\u8d26\u53f7\u7684\u8be6\u7ec6\u5bc6\u7801\u53c2\u6570;\n-d : \u540e\u9762\u63a5\u65e5\u671f\uff0c\u4fee\u6539 shadow \u7b2c\u4e09\u5b57\u6bb5(\u6700\u8fd1\u4e00\u6b21\u66f4\u6539\u5bc6\u7801\u7684\u65e5\u671f)\uff0c\u683c\u5f0f YYYY-MM-DD\n-E : \u540e\u9762\u63a5\u65e5\u671f\uff0c\u4fee\u6539 shadow \u7b2c\u516b\u5b57\u6bb5(\u8d26\u53f7\u5931\u6548\u65e5)\uff0c\u683c\u5f0f YYYY-MM-DD\n-I : \u540e\u9762\u63a5\u5929\u6570\uff0c\u4fee\u6539 shadow \u7b2c\u4e03\u5b57\u6bb5(\u5bc6\u7801\u5931\u6548\u65e5\u671f)\n-m : \u540e\u9762\u63a5\u5929\u6570\uff0c\u4fee\u6539 shadow \u7b2c\u56db\u5b57\u6bb5(\u5bc6\u7801\u6700\u77ed\u4fdd\u7559\u5929\u6570)\n-M : \u540e\u9762\u63a5\u5929\u6570\uff0c\u4fee\u6539 shadow \u7b2c\u4e94\u5b57\u6bb5(\u5bc6\u7801\u591a\u4e45\u9700\u8981\u8fdb\u884c\u53d8\u66f4) \n-W : \u540e\u9762\u63a5\u5929\u6570\uff0c\u4fee\u6539 shadow \u7b2c\u516d\u5b57\u6bb5(\u5bc6\u7801\u8fc7\u671f\u524d\u8b66\u544a\u65e5\u671f)\n</code></pre>\n\n<p>change \u6709\u4e2a\u547d\u4ee4\u53ef\u4ee5\u4f7f\u7528\u6237\u7b2c\u4e00\u6b21\u767b\u5f55\u540e\u5fc5\u987b\u66f4\u6539\u5bc6\u7801</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># chage -d 0 \u7528\u6237\n</code></pre>\n\n<h5 id=\"usermod\">usermod</h5>\n<p>\u4fee\u6539\u5bc6\u7801\u914d\u7f6e\u7684\u9009\u9879\u6570\u636e</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># usermod \u7528\u6237\u540d\n</code></pre>\n\n<p>\u9009\u9879\u53c2\u6570\uff1a</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-c : \u540e\u9762\u63a5\u8d26\u53f7\u7684\u8bf4\u660e\uff0c\u5373 /etc/passwd \u7b2c\u4e94\u680f\u7684\u8bf4\u660e\u680f\uff0c\u53ef\u4ee5\u52a0\u5165\u4e00\u4e9b\u8d26\u53f7\u7684\u8bf4\u660e\u3002\n-d : \u540e\u9762\u63a5\u8d26\u53f7\u7684\u5bb6\u76ee\u5f55\uff0c\u5373\u4fee\u6539 /etc/passwd \u7684\u7b2c\u516d\u680f;\n-e : \u540e\u9762\u63a5\u65e5\u671f\uff0c\u683c\u5f0f\u662f YYYY-MM-DD \u4e5f\u5c31\u662f\u5728 /etc/shadow \u5185\u7684\u7b2c\u516b\u4e2a\u5b57\u6bb5\u6570\u636e\u5566!\n-f : \u540e\u9762\u63a5\u5929\u6570\uff0c\u4e3a shadow \u7684\u7b2c\u4e03\u5b57\u6bb5\u3002\n-g : \u540e\u9762\u63a5\u521d\u59cb\u7fa4\u7ec4\uff0c\u4fee\u6539 /etc/passwd \u7684\u7b2c\u56db\u4e2a\u5b57\u6bb5\uff0c\u4ea6\u5373\u662f GID \u7684\u5b57\u6bb5!\n-G : \u540e\u9762\u63a5\u6b21\u8981\u7fa4\u7ec4\uff0c\u4fee\u6539\u8fd9\u4e2a\u4f7f\u7528\u8005\u80fd\u591f\u652f\u6301\u7684\u7fa4\u7ec4\uff0c\u4fee\u6539\u7684\u662f /etc/group \u5570~\n-a : \u4e0e -G \u5408\u7528\uff0c\u53ef\u589e\u52a0\u6b21\u8981\u7fa4\u7ec4\u7684\u652f\u6301\u800c\u975e\u8bbe\u5b9a\u5594!\n-l : \u540e\u9762\u63a5\u8d26\u53f7\u540d\u79f0\u3002\u4ea6\u5373\u662f\u4fee\u6539\u8d26\u53f7\u540d\u79f0\uff0c /etc/passwd \u7684\u7b2c\u4e00\u680f!\n-s : \u540e\u9762\u63a5 Shell \u7684\u5b9e\u9645\u6587\u4ef6\uff0c\u4f8b\u5982 /bin/bash \u6216 /bin/csh \u7b49\u7b49\u3002\n-u : \u540e\u9762\u63a5 UID \u6570\u5b57\u5566!\u5373 /etc/passwd \u7b2c\u4e09\u680f\u7684\u8d44\u6599;\n-L : \u6682\u65f6\u5c06\u7528\u6237\u7684\u5bc6\u7801\u51bb\u7ed3\uff0c\u8ba9\u4ed6\u65e0\u6cd5\u767b\u5165\u3002\u5176\u5b9e\u4ec5\u6539 /etc/shadow \u7684\u5bc6\u7801\u680f\u3002\n-U : \u5c06 /etc/shadow \u5bc6\u7801\u680f\u7684 ! \u62ff\u6389\uff0c\u89e3\u51bb\u5566!\n</code></pre>\n\n<h4 id=\"_6\">\u5220\u9664\u7528\u6237</h4>\n<p>\u5728\u5220\u9664\u524d\u53ef\u901a\u8fc7 \u201cfind  \u7528\u6237\u540d\u201d \u6765\u67e5\u51fa\u8be5\u7528\u6237\u7684\u6240\u6709\u6587\u4ef6\uff0c\u5bf9\u4e8e\u6587\u4ef6\u662f\u5426\u9700\u8981\u5b58\u7559\uff0c\u6765\u9009\u62e9\u901a\u8fc7\u4f55\u79cd\u65b9\u5f0f\u5220\u9664\u7528\u3002\u5982\u679c\u8be5\u8d26\u53f7\u53ea\u662f\u6682\u65f6\u4e0d\u542f\u7528\u7684\u8bdd\uff0c\u90a3\u4e48\u5c06 /etc/shadow \u91cc\u5934\u8d26\u53f7\u5931\u6548\u65e5\u671f (\u7b2c\u516b\u5b57\u6bb5) \u8bbe\u5b9a\u4e3a 0 \u5c31\u53ef\u4ee5\u8ba9\u8be5\u8d26\u53f7\u65e0\u6cd5\u4f7f\u7528\uff0c\u6240\u6709\u8ddf\u8be5\u8d26\u53f7\u76f8\u5173\u7684\u6570\u636e\u90fd\u4f1a\u7559\u4e0b\u6765\uff0c\u5982\u679c\u4e0d\u9700\u8981\u8be5\u7528\u6237\u7684\u6570\u636e\u5c31\u7528 userdel\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># userdel \u7528\u6237\u540d // \u5220\u9664 /etc/passwd \u4e0e /etc/shadow \u91cc\u7684\u8d26\u53f7\n</code></pre>\n\n<p>\u9009\u9879\u53c2\u6570\uff1a</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-r : \u8fde\u540c\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u4e5f\u4e00\u8d77\u5220\u9664\n</code></pre>\n\n<h3 id=\"_7\">\u7fa4\u7ec4\u7ba1\u7406</h3>\n<h4 id=\"_8\">\u7fa4\u7ec4\u4fe1\u606f\u76f8\u5173\u6587\u4ef6</h4>\n<h5 id=\"etcgroup\">/etc/group</h5>\n<p>\u6b64\u6587\u4ef6\u4e2d\u8bb0\u5f55\u4e86GID\u548c\u7ec4\u540d</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">root : x : 0 :\n\n\n1. \u7ec4\u540d\n2. \u7fa4\u7ec4\u5bc6\u7801\uff0c\u8fd9\u4e2a\u8bbe\u5b9a\u662f\u7ed9\u201c\u7fa4\u7ec4\u7ba1\u7406\u5458\u201d\u4f7f\u7528\u7684\uff0c\u4e0d\u8fc7\u5bc6\u7801\u5e76\u4e0d\u5728\u8fd9\uff0c\u5728 /etc/gshadow \u4e2d\n3. GID\uff0c\u7fa4\u7ec4ID\u3002\n4. \u7fa4\u7ec4\u4e0b\u7684\u7528\u6237\u6210\u5458\uff0c\u6bd4\u5982\u60f3\u8ba9 user1 \u548c user2 \u52a0\u5165 root\u7fa4\u7ec4\uff1aroot:x:0:user1,user2  (\u6ce8\u610f\uff1auser1\u4e0euser2\u4e4b\u95f4\u4e0d\u80fd\u7a7a\u683c)\n</code></pre>\n\n<h5 id=\"etcgshadow\">/etc/gshadow</h5>\n<p>\u6b64\u6587\u4ef6\u5b58\u50a8\u7740\u7fa4\u7ec4\u7ba1\u7406\u5458\u7684\u8d26\u53f7\u3001\u5bc6\u7801\u4fe1\u606f\u4ee5\u53ca\u7fa4\u7ec4\u5185\u7684\u7528\u6237\u6210\u5458</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">root: : :\n\n\n1. \u7fa4\u7ec4\u540d\n2. \u5bc6\u7801\u680f\n3. \u7fa4\u7ec4\u7ba1\u7406\u5458\u7684\u8d26\u53f7\n4. \u52a0\u5165\u8be5\u7fa4\u7ec4\u7684\u7528\u6237\u6210\u5458\uff0c\u4e0e /etc/group \u7684\u7b2c\u56db\u5b57\u6bb5\u76f8\u540c\n</code></pre>\n\n<h5 id=\"_9\">\u521d\u59cb\u7fa4\u7ec4</h5>\n<p>\u7528\u6237\u7684GID\u5c31\u662f\u7528\u6237\u7684\u521d\u59cb\u7fa4\u7ec4ID\uff0c\u521d\u59cb\u7fa4\u7ec4\u662f\u7528\u6237\u8d26\u53f7\u521b\u5efa\u65f6\u9ed8\u8ba4\u521b\u5efa\u7684\uff0c\u5bf9\u4e8e\u521d\u59cb\u7fa4\u7ec4\u4e0d\u4f1a\u5728\u4e0a\u9762\u7684\u7b2c\u56db\u4e2a\u5b57\u6bb5\u51fa\u73b0\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># grep \u7528\u6237\u540d /etc/group  // \u67e5\u8be2\u7528\u6237\u540d\u7684\u7fa4\u7ec4\u4fe1\u606f\n</code></pre>\n\n<h5 id=\"_10\">\u6709\u6548\u7fa4\u7ec4</h5>\n<p>\u4e00\u4e2a\u8d26\u53f7\u53ef\u4ee5\u52a0\u5165\u591a\u4e2a\u7fa4\u7ec4\uff0c\u5f53\u65b0\u5efa\u6587\u4ef6\u548c\u76ee\u5f55\u65f6\uff0c\u65b0\u6587\u4ef6\u7684\u6240\u5c5e\u7684\u7fa4\u7ec4\u662f\u5f53\u524d\u7684\u6709\u6548\u7fa4\u7ec4\uff0c\u9ed8\u8ba4\u4e0b\u4e3a\u5f53\u524d\u7528\u6237\u7684\u521d\u59cb\u7fa4\u7ec4\u3002\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u67e5\u8be2\uff0c\u5f53\u524d\u7528\u6237\u52a0\u5165\u7684\u7fa4\u7ec4</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># groups\n\n// \u8f93\u51fa\u6bd4\u5982\uff1auser1 user2\n</code></pre>\n\n<p>\u5982\u679c\u5f53\u524d\u767b\u5f55\u8eab\u4efd\u662fuser1\u90a3\u4e48\u65b0\u5efa\u6587\u4ef6\u7684\u6240\u5c5e\u7fa4\u9ed8\u8ba4\u5c31\u662fuser1\u4e86\uff0c\u5982\u679c\u60f3\u8ba9\u65b0\u5efa\u7684\u6587\u4ef6\u662f user2\uff0c\u53ef\u4ee5\u4f7f\u7528 newgrp \u547d\u4ee4\u5207\u6362\u6709\u6548\u7fa4\u7ec4\uff0c\u4f46\u662f\u5207\u6362\u7684\u76ee\u6807\u7fa4\u7ec4\u5fc5\u987b\u662f\u5f53\u524d\u7528\u6237\u52a0\u5165\u4e86\u7684\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">// user1\u7528\u6237\u5c06\u5f53\u524d\u6709\u6548\u7fa4\u7ec4user1\u5207\u6362\u81f3user2\uff0c\u5207\u6362\u540e\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u65b0\u7684shell\u73af\u5883\u4ee5\u652f\u6301\u6709\u6548\u7fa4\u7ec4 user2\n#  newgrp user2\n\n// \u9000\u51fa\u5f53\u524d\u6709\u6548\u7fa4\u7ec4 user2 \u8fd4\u56de user1\n# exit\n</code></pre>\n\n<h4 id=\"_11\">\u65b0\u589e\u7fa4\u7ec4</h4>\n<p>\u7fa4\u7ec4\u7684\u5185\u5bb9\u90fd\u4e0e\u8fd9\u4e24\u4e2a\u6587\u4ef6\u6709\u5173: /etc/group  \u3001 /etc/gshadow \uff0c\u90fd\u662f\u4e0a\u9762\u4e24\u4e2a \u6587\u4ef6\u7684\u65b0\u589e\u3001\u4fee\u6539\u4e0e\u79fb\u9664\u800c\u5df2\u3002</p>\n<h5 id=\"_12\">\u521b\u5efa\u7fa4\u7ec4</h5>\n<pre class=\"codehilite\"><code class=\"language-shell\"># groupadd \u7fa4\u7ec4\u540d\n</code></pre>\n\n<p>\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-g : \u540e\u9762\u63a5\u67d0\u4e2a\u7279\u5b9a\u7684 GID \uff0c\u7528\u6765\u76f4\u63a5\u7ed9\u4e88\u67d0\u4e2a GID\u3002\n-r : \u5efa\u7acb\u7cfb\u7edf\u7fa4\u7ec4\u5566!\u4e0e /etc/login.defs \u5185\u7684 GID_MIN \u6709\u5173\u3002\n</code></pre>\n\n<h5 id=\"_13\">\u4fee\u6539\u7fa4\u7ec4\u7684\u76f8\u5173\u53c2\u6570</h5>\n<pre class=\"codehilite\"><code class=\"language-shell\"># groupmod \u7fa4\u7ec4\u540d\n</code></pre>\n\n<p>\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-g :\u4fee\u6539\u65e2\u6709\u7684 GID \u6570\u5b57\n-n :\u4fee\u6539\u65e2\u6709\u7684\u7ec4\u540d\n</code></pre>\n\n<h4 id=\"_14\">\u5220\u9664\u7fa4\u7ec4</h4>\n<p>\u8981\u5220\u9664\u7684\u7fa4\u7ec4\u6ca1\u6709\u88ab\u5176\u4ed6\u7528\u6237\u4f5c\u4e3a initial group\uff08\u521d\u59cb\u7fa4\u7ec4\uff09\u65f6\u624d\u80fd\u88ab\u5220\u9664\uff0c\u5982\u679c\u6709\u7684\u8bdd\u53ef\u4ee5\u8003\u8651\u4fee\u6539 \u8be5\u7fa4\u7ec4\u7684GID \u6216\u8005 \u5220\u9664\u8be5\u7fa4\u7ec4\u7684\u4f7f\u7528\u8005\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># groupdel \u7fa4\u7ec4\u540d\n</code></pre>\n\n<h4 id=\"_15\">\u7fa4\u7ec4\u7ba1\u7406\u5458</h4>\n<p>\u7fa4\u7ec4\u7ba1\u7406\u5458\u53ef\u4ee5\u7ba1\u7406 \u54ea\u4e9b\u8d26\u53f7\u53ef\u4ee5\u52a0\u5165\u3001\u79fb\u51fa\u8be5\u7fa4\u7ec4\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">// \u8bbe\u7f6e\u7fa4\u7ec4\u5bc6\u7801\n# gpasswd \u7fa4\u7ec4\u540d\n\n// \u6307\u5b9a\u7528\u6237\u4e3a \u7fa4\u7ec4\u7ba1\u7406\u5458\n# gpasswd -A  \u7528\u6237\u540d  \u7fa4\u7ec4\u540d\n</code></pre>\n\n<p>\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">:\u540e\u9762\u63a5\u7fa4\u7ec4\u540d\uff0c\u8bbe\u7f6e\u6b64\u7fa4\u7ec4\u7684\u5bc6\u7801\uff0c\u82e5\u6ca1\u6709\u4efb\u4f55\u53c2\u6570\u65f6\uff0c\u8868\u793a\u7ed9\u4e88\u5f53\u524d\u7528\u6237\u7684\u521d\u59cb\u7fa4\u7ec4 \u4e00\u4e2a\u5bc6\u7801 (/etc/gshadow)\n-a : \u5411\u7fa4\u7ec4 GROUP \u4e2d\u6dfb\u52a0\u7528\u6237 USER\n-d : \u4ece\u7fa4\u7ec4 GROUP \u4e2d\u6dfb\u52a0\u6216\u5220\u9664\u7528\u6237\n-Q : \u8981 chroot \u8fdb\u7684\u76ee\u5f55\n-r : remove the GROUP's password\n-R : \u5411\u5176\u6210\u5458\u9650\u5236\u8bbf\u95ee\u7fa4\u7ec4\n-M : \u8bbe\u7f6e\u7fa4\u7ec4 GROUP \u7684\u6210\u5458\u5217\u8868\n-A : \u8bbe\u7f6e\u7fa4\u7ec4\u7684\u7ba1\u7406\u5458\u5217\u8868\n</code></pre>\n\n<h3 id=\"acl\">ACL \u7ec6\u90e8\u6743\u9650\u89c4\u5212</h3>\n<p>ACL \u662f Access Control List \u7684\u7f29\u5199\uff0c\u4e3b\u8981\u7684\u76ee\u7684\u662f\u5728\u63d0\u4f9b\u4f20\u7edf\u7684 owner,group,others \u7684 read,write,execute \u6743\u9650\u4e4b\u5916\u7684\u7ec6\u90e8\u6743\u9650\u8bbe\u5b9a\u3002ACL \u53ef\u4ee5\u9488\u5bf9\u5355\u4e00\u4f7f\u7528\u8005\uff0c\u5355\u4e00\u6587\u4ef6\u6216\u76ee\u5f55\u6765\u8fdb\u884c r,w,x \u7684\u6743\u9650\u89c4\u8303\uff0c\u5bf9\u4e8e\u9700\u8981\u7279\u6b8a\u6743\u9650\u7684\u4f7f\u7528\u72b6\u51b5\u975e\u5e38\u6709\u5e2e\u52a9\u3002</p>\n<ul>\n<li>\u4f7f\u7528\u8005 (user): \u53ef\u4ee5\u9488\u5bf9\u4f7f\u7528\u8005\u6765\u8bbe\u5b9a\u6743\u9650;</li>\n<li>\u7fa4\u7ec4 (group): \u9488\u5bf9\u7fa4\u7ec4\u4e3a\u5bf9\u8c61\u6765\u8bbe\u5b9a\u5176\u6743\u9650;</li>\n<li>\u9ed8\u8ba4\u5c5e\u6027 (mask): \u8fd8\u53ef\u4ee5\u9488\u5bf9\u5728\u8be5\u76ee\u5f55\u4e0b\u5728\u5efa\u7acb\u65b0\u6587\u4ef6/\u76ee\u5f55\u65f6\uff0c\u89c4\u8303\u65b0\u6570\u636e\u7684\u9ed8\u8ba4\u6743\u9650;</li>\n</ul>\n<p>\u901a\u8fc7\u6b64\u547d\u4ee4\u53ef\u67e5\u770b\u6838\u5fc3\u6302\u8f7d\u663e\u793a\u7684\u4fe1\u606f\u4e2d\u662f\u5426\u5df2\u7ecf\u652f\u6301 ACL</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># dmesg | grep -i acl\n\n\u8f93\u51fa\u4fe1\u606f\uff1a\n[    1.094372] systemd[1]: systemd 219 running in system mode. (+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN)\n[    3.634092] SGI XFS with ACLs, security attributes, no debug enabled\n</code></pre>\n\n<h4 id=\"_16\">\u8bbe\u5b9a\u67d0\u4e2a\u76ee\u5f55/\u6587\u4ef6\u7684\u6743\u9650</h4>\n<pre class=\"codehilite\"><code class=\"language-shell\"># setfacl [-bkRd] [{-m|-x} acl \u53c2\u6570] \u6587\u4ef6\u540d\n</code></pre>\n\n<p>\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-m : \u8bbe\u5b9a\u540e\u7eed\u7684 ACL \u53c2\u6570\u7ed9\u6587\u4ef6\u4f7f\u7528\uff0c\u4e0d\u53ef\u4e0e -x \u5408\u7528\n-x : \u5220\u9664\u540e\u7eed\u7684 ACL \u53c2\u6570\uff0c\u4e0d\u53ef\u4e0e -m \u5408\u7528\n-b : \u79fb\u9664 \u6240\u6709\u7684 ACL \u8bbe\u5b9a\u53c2\u6570\n-k : \u79fb\u9664 \u9884\u8bbe\u7684 ACL \u53c2\u6570\n-R : \u9012\u5f52\u8bbe\u5b9a ACL \uff0c\u4ea6\u5373\u5305\u62ec\u6b21\u76ee\u5f55\u90fd\u4f1a\u88ab\u8bbe\u5b9a\u8d77\u6765\n-d : \u8bbe\u5b9a\u201c\u9884\u8bbe ACL \u53c2\u6570\u201d\u7684\u610f\u601d!\u53ea\u5bf9\u76ee\u5f55\u6709\u6548\uff0c\u5728\u8be5\u76ee\u5f55\u65b0\u5efa\u7684\u6570\u636e\u4f1a\u5f15\u7528\u6b64\u9ed8\u8ba4\u503c\n</code></pre>\n\n<ul>\n<li>\u9488\u5bf9\u5355\u4e00\u4f7f\u7528\u8005\u7684\u6743\u9650\u8bbe\u5b9a</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">// \u5982\u679c\u4f7f\u7528\u8005\u8d26\u53f7\u5217\u8868\u4e3a\u7a7a\uff0c\u4ee3\u8868\u8bbe\u5b9a\u7684\u662f\u6587\u4ef6\u62e5\u6709\u8005\u7684\u6743\u9650\n# setfacl \u9009\u9879  u:\u4f7f\u7528\u8005\u8d26\u53f7\u5217\u8868:\u6743\u9650 \u6587\u4ef6\u540d\n\n// eg\uff1asetfacl -m u:user1:rx fieldName\n</code></pre>\n\n<ul>\n<li>\u9488\u5bf9\u5355\u4e00\u7fa4\u7ec4\u7684\u6743\u9650\u8bbe\u5b9a</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">// \u5982\u679c\u7fa4\u7ec4\u5217\u8868\u4e3a\u7a7a\uff0c\u4ee3\u8868\u8bbe\u5b9a\u7684\u662f\u6587\u4ef6\u6240\u5c5e\u7fa4\u7ec4\u7684\u6743\u9650\n# setfacl \u9009\u9879  g:\u7fa4\u7ec4\u5217\u8868:\u6743\u9650 \u6587\u4ef6\n\n// eg\uff1asetfacl -m g:group1:rx fieldName\n</code></pre>\n\n<ul>\n<li>\u9488\u5bf9\u6709\u6548\u6743\u9650\u8bbe\u5b9a\uff1a</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">// m:r -&gt; mask::r--\n# setfacl -m m:r fieldName\n</code></pre>\n\n<p>\u6709\u6548\u6743\u9650\u7684\u610f\u601d\u662f: \u4f7f\u7528\u8005\u6216\u7fa4\u7ec4\u6240\u8bbe\u5b9a\u7684\u6743\u9650\u5fc5\u987b\u8981\u5b58\u5728\u4e8e mask \u7684\u6743\u9650\u8bbe\u5b9a\u8303\u56f4\u5185\u624d\u4f1a\u751f\u6548\uff0c\u6bd4\u5982 user:user1:r-x \u4f46\u662f mask::r-- \u56e0\u6b64user1\u5176\u5b9e\u53ea\u6709 r \u7684\u6743\u9650\u3002</p>\n<ul>\n<li>\u4f7f\u7528\u9ed8\u8ba4\u6743\u9650\u8bbe\u5b9a\u76ee\u5f55\u672a\u6765\u6587\u4ef6\u7684 ACL \u6743\u9650\u7ee7\u627f</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">// \u5982\u679c\u4f7f\u7528\u8005\u8d26\u53f7\u5217\u8868\u4e3a\u7a7a\uff0c\u4ee3\u8868\u8bbe\u5b9a\u7684\u662f\u76ee\u5f55\u62e5\u6709\u8005\u7684\u6743\u9650\n# setfacl -m d:u:\u4f7f\u7528\u8005\u5217\u8868:\u6743\u9650  \u76ee\u5f55\n// eg\uff1asetfacl -m d:u:user1:rx /field/fieldName\n</code></pre>\n\n<p>\u5728\u6b64\u76ee\u5f55\u4e0b\u521b\u5efa\u7684\u6587\u4ef6\u4f1a\u7ee7\u627f\u76ee\u5f55\u7684\u6743\u9650\u8bbe\u5b9a</p>\n<h4 id=\"_17\">\u67e5\u770b\u6587\u4ef6\u7684\u6743\u9650\u5185\u5bb9</h4>\n<pre class=\"codehilite\"><code class=\"language-shell\"># getfacl \u6587\u4ef6\u540d\n\n\u8f93\u51fa\uff1a\n# file: \u6587\u4ef6\u540d\n# owner: root  // \u8bf4\u660e\u6b64\u6587\u4ef6\u7684\u62e5\u6709\u8005\uff0c\u4ea6\u5373 ls -l \u770b\u5230\u7684\u7b2c\u4e09\u4f7f\u7528\u8005\u5b57\u6bb5\n# group: root  // \u6b64\u6587\u4ef6\u7684\u6240\u5c5e\u7fa4\u7ec4\uff0c\u4ea6\u5373 ls -l \u770b\u5230\u7684\u7b2c\u56db\u7fa4\u7ec4\u5b57\u6bb5\nuser::rwx  // =\u4f7f\u7528\u8005\u5217\u8868\u680f\u662f\u7a7a\u7684\uff0c\u4ee3\u8868\u6587\u4ef6\u62e5\u6709\u8005\u7684\u6743\u9650\nuser:user1:r-x  // \u9488\u5bf9 user1 \u7684\u6743\u9650\u8bbe\u5b9a\u4e3a rx \uff0c\u4e0e\u62e5\u6709\u8005\u5e76\u4e0d\u540c!\ngroup::r-- // \u9488\u5bf9\u6587\u4ef6\u7fa4\u7ec4\u7684\u6743\u9650\u8bbe\u5b9a\u4ec5\u6709 r\nmask::r-x  // \u6b64\u6587\u4ef6\u9884\u8bbe\u7684\u6709\u6548\u6743\u9650\nother::r--  // \u5176\u4ed6\u4eba\u62e5\u6709\u7684\u6743\u9650\n</code></pre>\n\n<p>\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-m : \u8bbe\u5b9a\u540e\u7eed\u7684 ACL \u53c2\u6570\u7ed9\u6587\u4ef6\u4f7f\u7528\uff0c\u4e0d\u53ef\u4e0e -x \u5408\u7528\n-x : \u5220\u9664\u540e\u7eed\u7684 ACL \u53c2\u6570\uff0c\u4e0d\u53ef\u4e0e -m \u5408\u7528\n-b : \u79fb\u9664 \u6240\u6709\u7684 ACL \u8bbe\u5b9a\u53c2\u6570\n-k : \u79fb\u9664 \u9884\u8bbe\u7684 ACL \u53c2\u6570\n-R : \u9012\u5f52\u8bbe\u5b9a ACL \uff0c\u4ea6\u5373\u5305\u62ec\u6b21\u76ee\u5f55\u90fd\u4f1a\u88ab\u8bbe\u5b9a\u8d77\u6765\n-d : \u8bbe\u5b9a\u201c\u9884\u8bbe ACL \u53c2\u6570\u201d\u7684\u610f\u601d!\u53ea\u5bf9\u76ee\u5f55\u6709\u6548\uff0c\u5728\u8be5\u76ee\u5f55\u65b0\u5efa\u7684\u6570\u636e\u4f1a\u5f15\u7528\u6b64\u9ed8\u8ba4\u503c\n</code></pre>\n\n<h3 id=\"_18\">\u4f7f\u7528\u8005\u8eab\u4efd\u5207\u6362</h3>\n<h4 id=\"su\">su \u547d\u4ee4</h4>\n<pre class=\"codehilite\"><code class=\"language-shell\"># su -\u7528\u6237\u540d\n</code></pre>\n\n<p>\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">: su \u540e\u9762\u76f4\u63a5\u52a0\u7528\u6237\u540d\uff0c\u82e5\u4e0d\u52a0\u4ee3\u8868\u5207\u6362\u81f3 root\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u8bfb\u53d6\u7684\u53d8\u91cf\u8bbe\u5b9a\u65b9\u5f0f\u4e3a non-login shell \u7684\u65b9\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f \u5f88\u591a\u539f\u672c\u7684\u53d8\u91cf\u4e0d\u4f1a\u88ab\u6539\u53d8\uff0c\u4f7f\u7528 \u201csu\u201d \u5207\u6362\u5230 root \u6bd4\u5982\u73af\u5883\u8def\u5f84\u4e0d\u4f1a\u66f4\u6362\u6210 root \u7684\u3002\n\n- : \u5355\u7eaf\u4f7f\u7528 - \u5982\u201csu -\u201d\u4ee3\u8868\u4f7f\u7528 login-shell \u7684\u53d8\u91cf\u6587\u4ef6\u8bfb\u53d6\u65b9\u5f0f\u6765\u767b\u5165\u7cfb\u7edf\uff0c\n\u82e5\u4f7f\u7528\u8005\u540d\u79f0\u6ca1\u6709\u52a0\u4e0a\u53bb\uff0c\u5219\u4ee3\u8868\u5207\u6362\u4e3a root \u7684\u8eab\u4efd\u3002\n-l : \u4e0e - \u7c7b\u4f3c\uff0c\u4f46\u540e\u9762\u9700\u8981\u52a0\u6b32\u5207\u6362\u7684\u4f7f\u7528\u8005\u8d26\u53f7!\u4e5f\u662f login-shell \u7684\u65b9\u5f0f\u3002\n-m : -m \u4e0e -p \u662f\u4e00\u6837\u7684\uff0c\u8868\u793a\uff1a\u4f7f\u7528\u76ee\u524d\u7684\u73af\u5883\u8bbe\u5b9a\uff0c\u800c\u4e0d\u8bfb\u53d6\u65b0\u4f7f\u7528\u8005\u7684\u914d\u7f6e\u6587\u4ef6\n-c : \u4ec5\u8fdb\u884c\u4e00\u6b21\u6307\u4ee4\uff0c\u6240\u4ee5 -c \u540e\u9762\u53ef\u4ee5\u52a0\u4e0a\u6307\u4ee4\u5594!\n</code></pre>\n\n<p>\u7531\u4e8e\u5728 root \u8eab\u4efd\u4e0b\u7684 shell \u662f /sbin/nologin\uff0c\u6240\u4ee5\u65e0\u6cd5\u5207\u6362\u4f7f\u7528\u201csu -\u7528\u6237\u540d\u201d \u53bb\u5207\u6362\u8d26\u53f7\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 sudo \u6765\u4f7f\u7528\u8981\u5207\u6362\u81f3\u7684\u76ee\u6807\u7528\u6237\u7684\u6743\u9650\u3002</p>\n<h4 id=\"sudo\">sudo \u547d\u4ee4</h4>\n<p>\u76f8\u5bf9 su \u547d\u4ee4\u6765\u8bf4\uff0c\u6b64\u547d\u4ee4\u6267\u884c\u4e0d\u9700\u8981\u77e5\u9053\u5207\u6362\u7528\u6237\u7684\u5bc6\u7801\uff0c\u53ea\u9700\u8981\u81ea\u5df1\u7684\u5bc6\u7801\uff0c\u751a\u81f3\u53ef\u4ee5\u8bbe\u7f6e\u65e0\u9700\u5bc6\u7801\u3002\u5e76\u975e\u6240\u6709\u7528\u6237\u90fd\u80fd\u591f\u6267\u884c sudo \uff0c\u800c\u662f\u4ec5\u6709\u6dfb\u52a0\u5230 /etc/sudoers \u5185\u7684\u7528\u6237\u624d\u80fd\u591f\u6267\u884c sudo \u8fd9\u4e2a\u6307\u4ee4\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># sudo \u7528\u6237\u540d\n</code></pre>\n\n<p>\u9009\u9879\u4e0e\u53c2\u6570:</p>\n<pre class=\"codehilite\"><code class=\"language-shell\">-b : \u5c06\u540e\u7eed\u7684\u6307\u4ee4\u653e\u5230\u80cc\u666f\u4e2d\u8ba9\u7cfb\u7edf\u81ea\u884c\u6267\u884c\uff0c\u800c\u4e0d\u4e0e\u76ee\u524d\u7684 shell \u4ea7\u751f\u5f71\u54cd \n-u : \u540e\u9762\u53ef\u4ee5\u63a5\u6b32\u5207\u6362\u7684\u4f7f\u7528\u8005\uff0c\u82e5\u65e0\u6b64\u9879\u5219\u4ee3\u8868\u5207\u6362\u8eab\u4efd\u4e3a root \u3002\n\neg: sudo -u sshd touch /tmp/mysshd  // \u4ee5 sshd \u7684\u8eab\u4efd\u5728 /tmp \u5e95\u4e0b\u5efa\u7acb\u4e00\u4e2a\u540d\u4e3a mysshd \u7684\u6587\u4ef6\n</code></pre>\n\n<p>\u9664\u4e86 root \u4e4b\u5916\u7684\u5176\u4ed6\u8d26\u53f7\uff0c\u82e5\u60f3\u8981\u4f7f\u7528 sudo \u6267\u884c\u5c5e\u4e8e root \u7684\u6743\u9650 \u6307\u4ee4\uff0c\u5219 root \u9700\u8981\u5148\u4f7f\u7528 visudo \u53bb\u4fee\u6539 /etc/sudoers \uff0c\u8ba9\u8be5\u8d26\u53f7\u80fd\u591f\u4f7f\u7528\u5168\u90e8\u6216\u90e8\u5206\u7684 root \u6307\u4ee4</p>\n<h4 id=\"visudo-etcsudoers\">visudo\u4e0e /etc/sudoers</h4>\n<p>\u53ea\u6709\u914d\u7f6e\u5728 /etc/sudoers \u4e2d\u7684\u7528\u6237\u624d\u80fd\u4f7f\u7528 sudo \u547d\u4ee4\uff0c\u8be5\u6587\u4ef6\u521d\u59cb\u6dfb\u52a0\u7684\u7528\u6237\u662f root\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 vim \u53bb\u624b\u52a8\u4fee\u6539 /etc/sudoers \u6587\u4ef6\uff0c\u4f46\u662f\u5982\u679c\u8bbe\u5b9a\u9519\u8bef\u90a3\u4f1a\u9020\u6210\u65e0 \u6cd5\u4f7f\u7528 sudo \u6307\u4ee4\u7684\u4e0d\u826f\u540e\u679c\uff0c\u6240\u4ee5\u6211\u4eec\u91c7\u53d6\u4f7f\u7528 visudo \u547d\u4ee4\u8bbe\u5b9a\uff0cvisudo \u66f4\u6539\u540e\u5728\u79bb\u5f00\u4fee\u6539\u9875\u9762\u65f6\u7cfb\u7edf\u4f1a\u68c0\u67e5 /etc/sudoers \u7684\u8bed\u6cd5\u3002 </p>\n<ul>\n<li>\u5355\u4e00\u7528\u6237\u8bbe\u5b9a</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">\u4f7f\u7528\u8005\u8d26\u53f7     \u767b\u5165\u8005\u7684\u6765\u6e90\u4e3b\u673a\u540d=(\u53ef\u5207\u6362\u7684\u8eab\u4efd)     \u53ef\u4e0b\u8fbe\u7684\u6307\u4ee4\nroot                ALL=(ALL)                   ALL \n\n\n1. \u4f7f\u7528\u8005\u8d26\u53f7\uff1a\u7cfb\u7edf\u7684\u54ea\u4e2a\u8d26\u53f7\u53ef\u4ee5\u4f7f\u7528 sudo \u8fd9\u4e2a\u6307\u4ee4\u7684\u610f\u601d\n2. \u767b\u5165\u8005\u7684\u6765\u6e90\u4e3b\u673a\u540d\uff1a\u7f51\u7edc\u4e3b\u673a\u8054\u673a\u7684\u4e3b\u673a\u540d\uff0c\u8fd9\u4e2a\u8bbe\u5b9a\u503c\u53ef\u4ee5\u6307\u5b9a\u5ba2\u6237\u7aef\u8ba1\u7b97\u673a\uff08\u4fe1\u4efb\u7684\u6765\u6e90\u7684\u610f\u601d\uff09\u3002\n3. \u53ef\u5207\u6362\u7684\u8eab\u4efd\uff1a\u4ee5\u5207\u6362\u6210\u4ec0\u4e48\u8eab\u4efd\u6765\u4e0b\u8fbe\u540e\u7eed\u7684\u6307\u4ee4\uff0c\u9ed8\u8ba4 ALL\n4. \u53ef\u4e0b\u8fbe\u7684\u6307\u4ee4: \u53ef\u7528\u5207\u6362\u540e\u8eab\u4efd\u4e0b\u8fbe\u4ec0\u4e48\u6307\u4ee4\uff0c\u8fd9\u4e2a\u6307\u4ee4\u8bf7\u52a1\u5fc5\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u64b0\u5199\n\n// eg\uff1a# visudo\n// \u8f93\u51fa\uff1a\n// root       ALL=(ALL)       ALL\n// meanmouse  ALL=(ALL)       ALL\n// bear       ALL=(ALL)       ALL\n// \u65b0\u7528\u6237      ALL=(ALL)       ALL\n</code></pre>\n\n<ul>\n<li>wheel\u7fa4\u7ec4\u8bbe\u5b9a\uff08centos 7.0\u5f00\u59cb\u5f00\u653e\uff09</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">%\u7fa4\u7ec4\u540d  ALL=(ALL)       ALL  // \u6539\u7fa4\u7ec4\u5185\u7684\u7528\u6237\u90fd\u80fd\u4f7f\u7528 sudo\n</code></pre>\n\n<ul>\n<li>\u4f7f\u7528\u522b\u540d\u8bbe\u5b9a</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">// \u8bbe\u5b9a\u7528\u6237\u522b\u540d\nUser_Alias ADMPW = user1,user2\n// \u8bbe\u5b9a\u6307\u4ee4\u522b\u540d \nCmnd_Alias ADMPWCOM = !/usr/bin/passwd,/usr/bin/passwd[A-Za-z]*,!/usr/bin/passwd root\n// Host_Alias \u8bbe\u5b9a\u6765\u6e90\u4e3b\u673a\u522b\u540d\nHost_Alias ADMPWHOST = ALL\n\n// \u4f7f\u7528\u522b\u540d\u6279\u91cf\u8bbe\u5b9a\nADMPW     ADMPWHOST=(ALL)     ADMPWCOM\n</code></pre>\n\n<ul>\n<li>\u8bbe\u5b9a\u6267\u884c sudo \u4e0d\u9700\u8981\u5bc6\u7801</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">\u7528\u6237\u540d       ALL=(ALL)       NOPASSWD:ALL\n</code></pre>\n\n<ul>\n<li>\u9650\u5236\u7528\u6237\u6307\u4ee4\u64cd\u4f5c</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">\u7528\u6237\u540d       ALL=(ALL)      !\u6307\u4ee4\u52a1\u7edd\u5bf9\u8def\u5f84  // \u52a0\u611f\u53f9\u53f7\u8868\u793a\u7981\u6b62\n\n//eg\uff1auser1 ALL=(root) !/usr/bin/passwd, /usr/bin/passwd [A-Za-z]*, !/usr/bin/passwd root\n// \u5982\u4e0a user1 \u80fd\u4f7f\u7528\u4efb\u4f55\u8ba1\u7b97\u673a\u8fde\u63a5\u5e76\u4e14\u53ea\u80fd\u5207\u6362 root \u8eab\u4efd\uff0c\u5728 root \u8eab\u4efd\u4e0b\u80fd\u4f7f\u7528 passwd \u4efb\u610f\u5b57\u7b26\u547d\u4ee4\uff0c\u4f46\u662f\u7981\u6b62 passwd \u548c passwd root \u547d\u4ee4\u3002\n</code></pre>\n\n<ul>\n<li>sudo \u642d\u914d su \u65e0\u9700\u77e5\u9053 root \u5bc6\u7801\u5207\u6362\u81f3 root</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\">// \u8fd9\u6837\u8bbe\u5b9a\u540e\uff0c\u8be5\u7528\u6237\u53ef\u4ee5\u901a\u8fc7 sudo su - \u547d\u4ee4\u5e76\u8f93\u5165\u81ea\u5df1\u7684\u5bc6\u7801\u5c31\u80fd\u5207\u6362\u5230 root\n\u7528\u6237\u540d       ALL=(root)       /bin/su -\n</code></pre>\n\n<h3 id=\"_19\">\u8d26\u6237\u76f8\u5173\u7684\u68c0\u67e5\u5de5\u5177</h3>\n<h4 id=\"pwck\">pwck</h4>\n<p>\u8fd9\u4e2a\u6307\u4ee4\u5728\u68c0\u67e5 /etc/passwd \u8fd9\u4e2a\u8d26\u53f7\u914d\u7f6e\u6587\u4ef6\u5185\u7684\u4fe1\u606f\uff0c\u4e0e\u5b9e\u9645\u7684\u5bb6\u76ee\u5f55\u662f\u5426\u5b58\u5728\u7b49\u4fe1\u606f\uff0c \u8fd8\u53ef\u4ee5\u6bd4\u5bf9 /etc/passwd /etc/shadow \u7684\u4fe1\u606f\u662f\u5426\u4e00\u81f4\uff0c\u53e6\u5916\uff0c\u5982\u679c /etc/passwd \u5185\u7684\u6570\u636e\u5b57\u6bb5\u9519\u8bef\u65f6\uff0c \u4f1a\u63d0\u793a\u4f7f\u7528\u8005\u4fee\u8ba2\u3002</p>\n<pre class=\"codehilite\"><code class=\"language-shell\"># pwck\n</code></pre>\n\n<h4 id=\"pwconv\">pwconv</h4>\n<p>\u8fd9\u4e2a\u6307\u4ee4\u4e3b\u8981\u7684\u76ee\u7684\u662f\u5728\u201c\u5c06 /etc/passwd \u5185\u7684\u8d26\u53f7\u4e0e\u5bc6\u7801\uff0c\u79fb\u52a8\u5230 /etc/shadow \u5f53\u4e2d!\u201d \u65e9\u671f\u7684 Unix \u7cfb\u7edf\u5f53\u4e2d\u5e76\u6ca1\u6709 /etc/shadow \u5462\uff0c\u6240\u4ee5\uff0c\u7528\u6237\u7684\u767b\u5165\u5bc6\u7801\u65e9\u671f\u662f\u5728 /etc/passwd \u7684\u7b2c\u4e8c\u680f\uff0c\u540e\u6765\u4e3a\u4e86 \u7cfb\u7edf\u5b89\u5168\uff0c\u624d\u5c06\u5bc6\u7801\u6570\u636e\u79fb\u52a8\u5230 /etc/shadow \u5185\u7684\u3002</p>\n<ul>\n<li>\u6bd4\u5bf9 /etc/passwd \u53ca /etc/shadow \uff0c\u82e5 /etc/passwd \u5185\u5b58\u5728\u7684\u8d26\u53f7\u5e76\u6ca1\u6709\u5bf9\u5e94\u7684/etc/shadow \u5bc6\u7801\u65f6\uff0c\u5219 pwconv \u4f1a\u53bb /etc/login.defs \u53d6\u7528\u76f8\u5173\u7684\u5bc6\u7801\u6570\u636e\uff0c\u5e76\u5efa\u7acb\u8be5\u8d26\u53f7\u7684 /etc/shadow \u6570\u636e\u3002</li>\n<li>\u82e5 /etc/passwd \u5185\u5b58\u5728\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u6570\u636e\u65f6\uff0c\u5219 pwconv \u4f1a\u5c06\u8be5\u5bc6\u7801\u680f\u79fb\u52a8\u5230 /etc/shadow \u5185\uff0c\u5e76\u5c06\u539f\u672c\u7684 /etc/passwd \u5185\u76f8\u5bf9\u5e94\u7684\u5bc6\u7801\u680f\u53d8\u6210 x !</li>\n</ul>\n<pre class=\"codehilite\"><code class=\"language-shell\"># pwconv\n</code></pre>\n\n<h4 id=\"pwunconv\">pwunconv</h4>\n<p>\u76f8\u5bf9\u4e8e pwconv, pwunconv \u5219\u662f\u5c06 /etc/shadow \u5185\u7684\u5bc6\u7801\u680f\u6570\u636e\u5199\u56de /etc/passwd \u5f53\u4e2d\uff0c\u5e76\u4e14\u5220\u9664 /etc/shadow \u6587\u4ef6\u3002\u8fd9\u4e2a\u6307\u4ee4\u8bf4\u5b9e\u5728\u7684\uff0c\u6700\u597d\u4e0d\u8981\u4f7f\u7528\u5566! \u56e0\u4e3a\u4ed6\u4f1a\u5c06\u4f60\u7684 /etc/shadow \u5220\u9664! \u5982\u679c\u4f60\u5fd8\u8bb0\u5907\u4efd\uff0c\u53c8\u4e0d\u4f1a\u4f7f\u7528 pwconv \u7684\u8bdd\uff0c\u5f88\u4e25\u91cd\u5462!</p>\n<h4 id=\"chpasswd\">chpasswd</h4>\n<p>chpasswd \u53ef\u4ee5\u8bfb\u5165\u672a\u52a0\u5bc6\u524d\u7684\u5bc6\u7801\uff0c\u5e76\u4e14\u7ecf\u8fc7\u52a0\u5bc6\u540e\uff0c\u5c06\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u5199<br />\n\u5165 /etc/shadow \u5f53\u4e2d\u3002\u8fd9\u4e2a\u6307\u4ee4\u5f88\u5e38\u88ab\u4f7f\u7528\u5728\u5927\u91cf\u5efa\u7f6e\u8d26\u53f7\u7684\u60c5\u51b5\uff0c\u7531\u4e8e passwd \u5df2\u7ecf\u9ed8\u8ba4\u52a0\u5165\u4e86 --stdin \u7684\u9009\u9879\uff0c\u56e0\u6b64 chpasswd \u547d\u4ee4\u4fbf\u5f88\u5c11\u4f7f\u7528\u3002 </p>\n<pre class=\"codehilite\"><code class=\"language-shell\">// chpasswd \u4f1a\u53bb\u8bfb\u53d6 /etc/login.defs \u6587\u4ef6\u5185\u7684\u52a0\u5bc6\u673a\u5236\u52a0\u5bc6 \u5bc6\u7801\uff0c\u7136\u540e\u5199\u5165/etc/shadow \u5f53\u4e2d\n# echo &quot;\u7528\u6237\u540d:\u5bc6\u7801&quot; | chpasswd\n</code></pre>"}